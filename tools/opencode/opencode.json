{
  "$schema": "https://opencode.ai/config.json",

  "systemPrompt": "You are an expert Elixir/BEAM developer following strict AI rules from .ai_rules folder. Reference AGENTS.md, git_rules.md, project_requirements.md, and relevant roles/skills for all decisions. Follow Domain Resource Action pattern, OTP best practices, TDD workflow, and Git workflow conventions. Always communicate clearly and explain your actions.",

  "tools": {
    "write": true,
    "read": true,
    "bash": true,
    "grep": true,
    "glob": true,
    "webfetch": true,
    "websearch": true
  },

  "mcp": {
    "serena": {
      "type": "local",
      "command": ["uvx", "--from", "git+https://github.com/oraios/serena", "serena", "start-mcp-server"],
      "enabled": true,
      "environment": {
        "SERENA_PROJECT_PATH": "{project_root}/.serena",
        "SERENA_READ_ONLY": "false"
      }
    }
  },

  "localModels": {
    "ollama": {
      "enabled": true,
      "baseURL": "http://localhost:11434",
      "models": {
        "plan": "llama3.1:70b-instruct-q8_0",
        "build": "deepseek-coder-v2:16b-instruct",
        "review": "llama3.1:70b-instruct-q8_0"
      }
    },
    "lmstudio": {
      "enabled": true,
      "baseURL": "http://localhost:1234/v1",
      "models": {
        "plan": "phi-4-mini-instruct",
        "build": "phi-4-mini-instruct",
        "review": "phi-4-mini-instruct"
      }
    },
    "mlx": {
      "enabled": false,
      "config": {
        "tensor_parallel": 5,
        "max_gpus": 5,
        "model_path": "/path/to/mlx/models"
      }
    }
  },

  "apiModels": {
    "anthropic": {
      "enabled": true,
      "apiKey": "${ANTHROPIC_API_KEY}",
      "models": {
        "plan": "claude-3-5-sonnet-20241022",
        "build": "claude-3-5-sonnet-20241022",
        "review": "claude-3-5-sonnet-20241022"
      }
    },
    "openai": {
      "enabled": false,
      "apiKey": "${OPENAI_API_KEY}",
      "models": {
        "plan": "gpt-4o",
        "build": "gpt-4o-mini",
        "review": "gpt-4o"
      }
    }
  },

  "agent": {
    "mode": "build",

    "plan": {
      "systemPrompt": "PLAN MODE: You are an Architect planning an Elixir/BEAM project. Read project_requirements.md for LLM selection and tool preferences. Use mgrep for semantic codebase discovery. Create file structure and identify architectural patterns before implementation. Output your plan clearly with phases, dependencies, and file locations. Do not create or modify files in plan mode.",
      "tools": {
        "write": false,
        "mgrep": true,
        "serena_*": false,
        "grep": true,
        "websearch": true,
        "bash": false
      },
      "model": {
        "provider": "auto",
        "prefer": "api",
        "fallback": ["anthropic", "ollama"]
      }
    },

    "build": {
      "systemPrompt": "BUILD MODE: You are an Orchestrator implementing an Elixir/BEAM project. Follow project_requirements.md for model selection and git_rules.md for Git operations. Use Serena for semantic search + editing. Implement TDD, Domain Resource Action pattern, and OTP best practices. Use /create-feature command for new features, /full-test before committing. Always write tests before implementation (TDD). For Git: create feature branches, use conventional commits, create PRs with descriptions, and squash merge. Reference Git Specialist role (roles/git-specialist.md) for Git operations.",
      "tools": {
        "write": true,
        "mgrep": false,
        "serena_*": true,
        "grep": true,
        "bash": true
      },
      "model": {
        "provider": "local",
        "default": "ollama",
        "model": "deepseek-coder-v2:16b-instruct"
      }
    },

    "review": {
      "systemPrompt": "REVIEW MODE: You are a Reviewer/QA specialist. Use mgrep for cross-reference analysis and Serena for edit context. Verify OTP patterns, Domain Resource Action adherence, and code quality. Run Credo, Dialyzer, and test coverage. Reference relevant roles (reviewer.md, qa.md, git-specialist.md) from .ai_rules/roles/. Provide specific, actionable feedback with clear explanations. For PR reviews, use gh CLI to review and approve PRs following git_rules.md conventions.",
      "tools": {
        "write": false,
        "mgrep": true,
        "serena_*": true,
        "grep": true,
        "bash": true
      },
      "model": {
        "provider": "api",
        "default": "anthropic",
        "model": "claude-3-5-sonnet-20241022"
      }
    }
  },

  "permissions": {
    "write": "ask",
    "bash": "ask",
    "mcp": "ask"
  }
}
